@using NotikaIdentityEmail.Areas.Admin.Models
@model DashboardViewModel

@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="analysis-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="analysis-progrebar-ctn">
                    <h4>Toplam Kullanıcı</h4>
                    <h2>@Model.UserCount</h2>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="analysis-progrebar-ctn">
                    <h4>Toplam Mesaj</h4>
                    <h2>@Model.MessageCount</h2>
                    <p>@Model.UnreadMessageCount okunmamış</p>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="analysis-progrebar-ctn">
                    <h4>Taslak / Çöp</h4>
                    <h2>@Model.DraftCount / @Model.TrashCount</h2>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="analysis-progrebar-ctn">
                    <h4>Error (24s)</h4>
                    <h2 class="text-danger">@Model.ErrorCountLast24h</h2>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="data-table-area">
    <div class="container">
        <div class="row">

            <!-- 🔹 Son Mesajlar -->
            <div class="col-lg-6">
                <div class="data-table-list">
                    <div class="basic-tb-hd">
                        <h2>Son Mesajlar</h2>
                    </div>

                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Gönderen</th>
                                <th>Konu</th>
                                <th>Kategori</th>
                                <th>Tarih</th>
                                <th>Durum</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var m in Model.RecentMessages)
                            {
                                <tr>
                                    <td>@m.SenderEmail</td>
                                    <td>@m.Subject</td>
                                    <td>@m.CategoryName</td>
                                    <td>@m.SendDate.ToString("dd.MM.yyyy HH:mm")</td>
                                    <td>
                                        @if (m.IsRead)
                                        {
                                            <span class="label label-success">Okundu</span>
                                        }
                                        else
                                        {
                                            <span class="label label-warning">Okunmadı</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 🔥 Elasticsearch Logları -->
            <div class="col-lg-6">
                <div class="data-table-list">
                    <div class="basic-tb-hd">
                        <h2>Son Loglar (Elasticsearch)</h2>
                    </div>

                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Zaman</th>
                                <th>Level</th>
                                <th>Mesaj</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var log in Model.LatestElasticLogs)
                            {
                                var rowClass =
                                log.Level == "Error" || log.Level == "Fatal"
                                ? "danger"
                                : "";

                                <tr class="@rowClass">
                                    <td>@log.Timestamp.ToString("HH:mm:ss")</td>
                                    <td>@log.Level</td>
                                    <td>
                                        <a asp-area="Admin"
                                           asp-controller="Logs"
                                           asp-action="Detail"
                                           asp-route-id="@log.Id">
                                            @(log.MessageTemplate ?? log.RenderedMessage)
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    @if (!string.IsNullOrWhiteSpace(Model.KibanaUrl))
                    {
                        <a href="@Model.KibanaUrl"
                           target="_blank"
                           class="btn btn-info btn-sm">
                            Kibana’da Detaylı Gör
                        </a>
                    }
                </div>
            </div>

        </div>
    </div>
</div>
