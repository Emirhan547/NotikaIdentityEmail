<!doctype html>
<html class="no-js" lang="tr">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>@ViewData["Title"] - Notika Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" type="image/x-icon" href="~/notika-master/notika/green-horizotal/img/favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900" rel="stylesheet">

    <link rel="stylesheet" href="~/notika-master/notika/green-horizotal/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/notika-master/notika/green-horizotal/css/font-awesome.min.css">
    <link rel="stylesheet" href="~/notika-master/notika/green-horizotal/css/animate.css">
    <link rel="stylesheet" href="~/notika-master/notika/green-horizotal/css/normalize.css">
    <link rel="stylesheet" href="~/notika-master/notika/green-horizotal/css/notika-custom-icon.css">
    <link rel="stylesheet" href="~/notika-master/notika/green-horizotal/css/main.css">
    <link rel="stylesheet" href="~/notika-master/notika/green-horizotal/style.css">
    <link rel="stylesheet" href="~/notika-master/notika/green-horizotal/css/responsive.css">
</head>
<body>

    <div class="header-top-area">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-4">
                    <div class="logo-area">
                        <a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">
                            <img src="~/notika-master/notika/green-horizotal/img/logo/logo.png" alt="Notika Admin">
                        </a>
                    </div>
                </div>

                <div class="col-lg-8">
                    <div class="header-top-menu">
                        <ul class="nav navbar-nav notika-top-nav">

                            <!-- 🔥 LOGS + REALTIME ERROR BADGE -->
                            <li class="nav-item">
                                <a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">
                                    <i class="notika-icon notika-bar-chart"></i>
                                    Logs
                                    <span id="adminErrorBadge"
                                          class="badge badge-danger"
                                          style="display:none;">0</span>
                                </a>
                            </li>

                            <li class="nav-item">
                                <a asp-area="Admin" asp-controller="Category" asp-action="Index">
                                    <i class="notika-icon notika-edit"></i> Kategoriler
                                </a>
                            </li>

                            <li class="nav-item">
                                <a asp-area="Admin" asp-controller="Role" asp-action="RoleList">
                                    <i class="notika-icon notika-menus"></i> Roller
                                </a>
                            </li>

                            <li class="nav-item">
                                <a asp-area="Admin" asp-controller="Role" asp-action="UserList">
                                    <i class="notika-icon notika-support"></i> Kullanıcılar
                                </a>
                            </li>

                            <li class="nav-item">
                                <a asp-area="" asp-controller="Profile" asp-action="EditProfile">
                                    <i class="notika-icon notika-user"></i> Profil
                                </a>
                            </li>

                            <li class="nav-item">
                                <span class="nav-link text-muted">
                                    Hoş geldin, @User.Identity?.Name
                                </span>
                            </li>

                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="breadcomb-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcomb-list">
                        <div class="breadcomb-wp">
                            <div class="breadcomb-icon">
                                <i class="notika-icon notika-house"></i>
                            </div>
                            <div class="breadcomb-ctn">
                                <h2>@ViewData["Title"]</h2>
                                <p>Admin alanında güncel içeriklere hızlı erişim.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @RenderBody()

    <div class="footer-copyright-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="footer-copy-right">
                        <p>Notika Admin Dashboard • @DateTime.Now.Year</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="~/notika-master/notika/green-horizotal/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="~/notika-master/notika/green-horizotal/js/bootstrap.min.js"></script>
    <script src="~/notika-master/notika/green-horizotal/js/wow.min.js"></script>
    <script src="~/notika-master/notika/green-horizotal/js/main.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.2/signalr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        (function () {

            const isAdmin = @User.IsInRole("Admin").ToString().ToLower();
            if (!isAdmin) return;

            const connection = new signalR.HubConnectionBuilder()
                .withUrl("/hubs/notification")
                .withAutomaticReconnect()
                .build();

            function increaseErrorBadge() {
                const badge = document.getElementById("adminErrorBadge");
                if (!badge) return;

                const current = parseInt(badge.textContent || "0", 10) || 0;
                badge.textContent = (current + 1).toString();
                badge.style.display = "inline-block";
            }

            connection.start()
                .then(() => connection.invoke("JoinUserGroup", "admins"))
                .catch(err => console.error("SignalR admin error:", err));

            connection.on("NewError", function (data) {
                increaseErrorBadge();

                Swal.fire({
                    toast: true,
                    position: 'top-end',
                    icon: 'error',
                    title: 'Yeni Sistem Hatası',
                    text: data.message,
                    showConfirmButton: false,
                    timer: 4000
                });
            });

        })();
    </script>

    @RenderSection("Scripts", required: false)

</body>
</html>
